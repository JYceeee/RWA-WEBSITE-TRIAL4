import{_ as w,r as _,a as O,c as v,C,o as G,b as a,d as r,e as s,f as y,n as A,t as l,w as $,g as d,v as b,h as E,F as m,i as g}from"./index-O3xP0FB3.js";const H={class:"contract-config"},h={class:"config-section"},J={class:"config-display"},M={class:"config-item"},q={class:"config-item"},j={class:"config-item"},B={class:"config-item"},z={class:"config-section"},Q={class:"env-config-display"},X={class:"env-config-item"},Z={class:"env-config-item"},ss={class:"env-config-item"},ts={class:"env-config-item"},ns={class:"env-config-item"},es={class:"config-section"},ls={class:"form-group"},os={class:"form-group"},is={class:"form-group"},as={class:"form-group"},rs={class:"form-group"},ds={class:"form-group"},us={class:"form-group"},Ss={class:"form-group"},Es={class:"form-actions"},Rs=["disabled"],_s={key:0,class:"config-section"},vs={class:"validation-results"},Ds={class:"validation-icon"},Ts={class:"validation-message"},ps={class:"config-section"},Cs={class:"history-list"},As={class:"history-header"},ms={class:"history-env"},gs={class:"history-time"},fs={class:"history-summary"},cs={key:0,class:"no-history"},Ns={__name:"ContractConfigView",setup(Is){const u=_("dev"),e=O({KYC_REGISTRY_ADDRESS:"",LOAN_ISSUER_ADDRESS:"",PRINCIPAL_TOKEN_ADDRESS:"",INTEREST_TOKEN_ADDRESS:"",TRADE_CONTRACT_ADDRESS:"",NETWORK:{chainId:11155111,name:"Sepolia Testnet"}}),S=_([]),i=_([]),D=_(C),f=v(()=>u.value==="dev"?"开发环境":"生产环境"),R=O({KYC_DEFAULT_SUCCESS:void 0,KYC_DEFAULT_LEVEL:void 0,NETWORK_CHAIN_ID:void 0,KYC_REGISTRY_ADDRESS:"0x4533f47BE0ce8b80F7bbdF02939f81F4A15b7A45",TRADE_CONTRACT_ADDRESS:void 0}),K=v(()=>C.KYC?.DEFAULT_SUCCESS?"已验证":"未验证"),L=v(()=>C.KYC?.DEFAULT_SUCCESS?"success":"warning"),c=v(()=>["KYC_REGISTRY_ADDRESS","LOAN_ISSUER_ADDRESS","PRINCIPAL_TOKEN_ADDRESS","INTEREST_TOKEN_ADDRESS","TRADE_CONTRACT_ADDRESS"].every(t=>{const n=e[t];return n&&n.startsWith("0x")&&n.length===42})),T=()=>{const o=localStorage.getItem(`contractConfig_${u.value}`);o?Object.assign(e,JSON.parse(o)):u.value==="dev"?Object.assign(e,{KYC_REGISTRY_ADDRESS:"",LOAN_ISSUER_ADDRESS:"",PRINCIPAL_TOKEN_ADDRESS:"",INTEREST_TOKEN_ADDRESS:"",TRADE_CONTRACT_ADDRESS:"",NETWORK:{chainId:11155111,name:"Sepolia Testnet"}}):Object.assign(e,{KYC_REGISTRY_ADDRESS:"",LOAN_ISSUER_ADDRESS:"",PRINCIPAL_TOKEN_ADDRESS:"",INTEREST_TOKEN_ADDRESS:"",TRADE_CONTRACT_ADDRESS:"",NETWORK:{chainId:1,name:"Ethereum Mainnet"}})},Y=()=>{if(!c.value){alert("请填写所有必需的合约地址");return}localStorage.setItem(`contractConfig_${u.value}`,JSON.stringify(e)),i.value.unshift({env:u.value,timestamp:Date.now(),addresses:{...e}}),i.value.length>10&&(i.value=i.value.slice(0,10)),localStorage.setItem("configHistory",JSON.stringify(i.value)),alert("配置已保存！")},U=()=>{confirm("确定要重置当前配置吗？")&&T()},x=()=>{S.value=[],[{key:"KYC_REGISTRY_ADDRESS",name:"KYC注册表合约"},{key:"LOAN_ISSUER_ADDRESS",name:"Loan发行者合约"},{key:"PRINCIPAL_TOKEN_ADDRESS",name:"本金代币合约"},{key:"INTEREST_TOKEN_ADDRESS",name:"利息代币合约"},{key:"TRADE_CONTRACT_ADDRESS",name:"交易合约"}].forEach(t=>{const n=e[t.key];n?!n.startsWith("0x")||n.length!==42?S.value.push({status:"error",message:`${t.name}地址格式无效`}):S.value.push({status:"success",message:`${t.name}地址格式正确`}):S.value.push({status:"error",message:`${t.name}地址不能为空`})})},F=o=>new Date(o).toLocaleString(),V=async()=>{try{const o=await navigator.clipboard.readText(),t=JSON.parse(o);Object.assign(e,t),alert("配置已从剪贴板导入")}catch{alert("剪贴板内容格式错误")}},k=async()=>{try{await navigator.clipboard.writeText(JSON.stringify(e,null,2)),alert("配置已复制到剪贴板")}catch{alert("复制失败")}},P=()=>{confirm("确定要清除所有配置历史吗？")&&(i.value=[],localStorage.removeItem("configHistory"),alert("历史记录已清除"))},W=()=>{alert("连接测试功能待实现")};return G(()=>{T();const o=localStorage.getItem("configHistory");o&&(i.value=JSON.parse(o))}),(o,t)=>(r(),a("div",H,[t[39]||(t[39]=s("h1",null,"智能合约地址配置",-1)),s("div",h,[t[12]||(t[12]=s("h2",null,"📋 当前配置",-1)),s("div",J,[s("div",M,[t[8]||(t[8]=s("label",null,"环境:",-1)),s("span",{class:A(["env-badge",f.value])},l(f.value),3)]),s("div",q,[t[9]||(t[9]=s("label",null,"网络:",-1)),s("span",null,l(D.value.NETWORK.name)+" ("+l(D.value.NETWORK.chainId)+")",1)]),s("div",j,[t[10]||(t[10]=s("label",null,"KYC默认状态:",-1)),s("span",{class:A(["kyc-badge",L.value])},l(K.value),3)]),s("div",B,[t[11]||(t[11]=s("label",null,"KYC默认级别:",-1)),s("span",null,"Level "+l(D.value.KYC?.DEFAULT_LEVEL||"N/A"),1)])])]),s("div",z,[t[18]||(t[18]=s("h2",null,"🔧 环境变量配置",-1)),s("div",Q,[s("div",X,[t[13]||(t[13]=s("label",null,"VITE_KYC_DEFAULT_SUCCESS:",-1)),s("span",null,l(R.KYC_DEFAULT_SUCCESS||"未设置"),1)]),s("div",Z,[t[14]||(t[14]=s("label",null,"VITE_KYC_DEFAULT_LEVEL:",-1)),s("span",null,l(R.KYC_DEFAULT_LEVEL||"未设置"),1)]),s("div",ss,[t[15]||(t[15]=s("label",null,"VITE_NETWORK_CHAIN_ID:",-1)),s("span",null,l(R.NETWORK_CHAIN_ID||"未设置"),1)]),s("div",ts,[t[16]||(t[16]=s("label",null,"VITE_KYC_REGISTRY_ADDRESS:",-1)),s("span",null,l(R.KYC_REGISTRY_ADDRESS||"未设置"),1)]),s("div",ns,[t[17]||(t[17]=s("label",null,"VITE_TRADE_CONTRACT_ADDRESS:",-1)),s("span",null,l(R.TRADE_CONTRACT_ADDRESS||"未设置"),1)])]),t[19]||(t[19]=s("div",{class:"env-note"},[s("p",null,"💡 提示：环境变量配置优先于界面配置。请创建 .env 文件来设置这些变量。")],-1))]),s("div",es,[t[35]||(t[35]=s("h2",null,"⚙️ 更新合约地址",-1)),s("form",{onSubmit:$(Y,["prevent"]),class:"config-form"},[s("div",ls,[t[21]||(t[21]=s("label",null,"目标环境:",-1)),d(s("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),onChange:T},[...t[20]||(t[20]=[s("option",{value:"dev"},"开发环境 (Sepolia测试网)",-1),s("option",{value:"prod"},"生产环境 (Ethereum主网)",-1)])],544),[[b,u.value]])]),s("div",os,[t[22]||(t[22]=s("label",null,"KYC注册表合约地址:",-1)),d(s("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.KYC_REGISTRY_ADDRESS=n),type:"text",placeholder:"0x...",pattern:"^0x[a-fA-F0-9]{40}$",title:"请输入有效的以太坊地址"},null,512),[[E,e.KYC_REGISTRY_ADDRESS]]),t[23]||(t[23]=s("small",null,"用于KYC验证和用户权限管理",-1))]),s("div",is,[t[24]||(t[24]=s("label",null,"Loan发行者合约地址:",-1)),d(s("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>e.LOAN_ISSUER_ADDRESS=n),type:"text",placeholder:"0x...",pattern:"^0x[a-fA-F0-9]{40}$",title:"请输入有效的以太坊地址"},null,512),[[E,e.LOAN_ISSUER_ADDRESS]]),t[25]||(t[25]=s("small",null,"用于贷款发行和管理",-1))]),s("div",as,[t[26]||(t[26]=s("label",null,"本金代币合约地址:",-1)),d(s("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>e.PRINCIPAL_TOKEN_ADDRESS=n),type:"text",placeholder:"0x...",pattern:"^0x[a-fA-F0-9]{40}$",title:"请输入有效的以太坊地址"},null,512),[[E,e.PRINCIPAL_TOKEN_ADDRESS]]),t[27]||(t[27]=s("small",null,"代表本金资产的ERC20代币",-1))]),s("div",rs,[t[28]||(t[28]=s("label",null,"利息代币合约地址:",-1)),d(s("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>e.INTEREST_TOKEN_ADDRESS=n),type:"text",placeholder:"0x...",pattern:"^0x[a-fA-F0-9]{40}$",title:"请输入有效的以太坊地址"},null,512),[[E,e.INTEREST_TOKEN_ADDRESS]]),t[29]||(t[29]=s("small",null,"代表利息收益的ERC20代币",-1))]),s("div",ds,[t[30]||(t[30]=s("label",null,"交易合约地址:",-1)),d(s("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>e.TRADE_CONTRACT_ADDRESS=n),type:"text",placeholder:"0x...",pattern:"^0x[a-fA-F0-9]{40}$",title:"请输入有效的以太坊地址"},null,512),[[E,e.TRADE_CONTRACT_ADDRESS]]),t[31]||(t[31]=s("small",null,"用于代币买卖交易",-1))]),s("div",us,[t[33]||(t[33]=s("label",null,"网络ID:",-1)),d(s("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>e.NETWORK.chainId=n)},[...t[32]||(t[32]=[s("option",{value:11155111},"Sepolia测试网 (11155111)",-1),s("option",{value:1},"Ethereum主网 (1)",-1),s("option",{value:5},"Goerli测试网 (5)",-1),s("option",{value:137},"Polygon主网 (137)",-1),s("option",{value:80001},"Polygon Mumbai (80001)",-1)])],512),[[b,e.NETWORK.chainId]])]),s("div",Ss,[t[34]||(t[34]=s("label",null,"网络名称:",-1)),d(s("input",{"onUpdate:modelValue":t[7]||(t[7]=n=>e.NETWORK.name=n),type:"text",placeholder:"网络名称"},null,512),[[E,e.NETWORK.name]])]),s("div",Es,[s("button",{type:"button",onClick:U,class:"btn secondary"},"重置"),s("button",{type:"button",onClick:x,class:"btn warning"},"验证"),s("button",{type:"submit",disabled:!c.value,class:"btn primary"},"保存配置",8,Rs)])],32)]),S.value.length>0?(r(),a("div",_s,[t[36]||(t[36]=s("h2",null,"🔍 验证结果",-1)),s("div",vs,[(r(!0),a(m,null,g(S.value,(n,p)=>(r(),a("div",{key:p,class:A(["validation-item",n.status])},[s("span",Ds,l(n.status==="success"?"✅":"❌"),1),s("span",Ts,l(n.message),1)],2))),128))])])):y("",!0),s("div",ps,[t[37]||(t[37]=s("h2",null,"📚 配置历史",-1)),s("div",Cs,[(r(!0),a(m,null,g(i.value,(n,p)=>(r(),a("div",{key:p,class:"history-item"},[s("div",As,[s("span",ms,l(n.env),1),s("span",gs,l(F(n.timestamp)),1)]),s("div",fs,[(r(!0),a(m,null,g(n.addresses,(N,I)=>(r(),a("span",{key:I,class:"history-address"},l(I)+": "+l(N.slice(0,6))+"..."+l(N.slice(-4)),1))),128))])]))),128)),i.value.length===0?(r(),a("div",cs," 暂无配置历史 ")):y("",!0)])]),s("div",{class:"config-section"},[t[38]||(t[38]=s("h2",null,"🚀 快速操作",-1)),s("div",{class:"quick-actions"},[s("button",{onClick:V,class:"btn secondary"},"从剪贴板导入"),s("button",{onClick:k,class:"btn secondary"},"导出到剪贴板"),s("button",{onClick:P,class:"btn secondary"},"清除历史"),s("button",{onClick:W,class:"btn warning"},"测试连接")])])]))}},ys=w(Ns,[["__scopeId","data-v-cd86df7a"]]);export{ys as default};
