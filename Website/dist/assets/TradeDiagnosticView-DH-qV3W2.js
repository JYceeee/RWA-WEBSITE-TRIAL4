import{_ as ss,u as ts,r as v,C as R,c as b,o as es,b as p,d as _,e as s,n as u,t as a,f as F,j as k,g as as,h as ns,F as H,i as O,k as A}from"./index-O3xP0FB3.js";const ls={class:"trade-diagnostic"},os={class:"diagnostic-overview"},is={class:"status-grid"},cs={class:"status-icon"},us={class:"status-text"},rs={class:"status-icon"},ds={class:"status-text"},vs={class:"status-icon"},gs={class:"status-text"},ms={class:"status-icon"},fs={class:"status-text"},bs={class:"diagnostic-details"},ps={class:"diagnostic-section"},_s={class:"info-grid"},hs={class:"info-item"},ks={class:"info-item"},ws={class:"info-item"},ys={class:"info-item"},Cs={class:"action-buttons"},Ts=["disabled"],Ss={class:"diagnostic-section"},xs={class:"info-grid"},Ds={class:"info-item"},Es={class:"info-item"},Is={class:"info-item"},Rs={class:"info-item"},As={class:"diagnostic-section"},Ns={class:"info-grid"},$s={class:"info-item"},Bs={class:"info-item"},Ls={class:"info-item"},Fs={class:"diagnostic-section"},Hs={class:"test-form"},Os={class:"form-group"},Us={class:"action-buttons"},Vs=["disabled"],js=["disabled"],Ms={key:0,class:"diagnostic-section"},Ws={class:"error-logs"},Ks={class:"error-time"},Ys={class:"error-message"},zs={key:1,class:"diagnostic-section"},Gs={class:"suggestions"},qs={class:"suggestion-text"},Js={__name:"TradeDiagnosticView",setup(Ps){const{connected:i,address:N,chainId:r,networkLabel:$,nativeBalance:B,connect:U,refreshTokens:V}=ts(),g=v(1),d=v([]),l=v([]),m=v(R.TRADE_CONTRACT_ADDRESS),w=v(R.KYC_REGISTRY_ADDRESS),o=v(R.NETWORK),y=v("0"),j=v("0"),S=b(()=>i.value?{class:"success",icon:"✅",message:"钱包已连接"}:{class:"error",icon:"❌",message:"钱包未连接"}),x=b(()=>m.value&&m.value!=="0x..."?{class:"success",icon:"✅",message:"合约已配置"}:{class:"error",icon:"❌",message:"合约未配置"}),D=b(()=>r.value===o.value.chainId?{class:"success",icon:"✅",message:"网络匹配"}:r.value?{class:"warning",icon:"⚠️",message:"网络不匹配"}:{class:"error",icon:"❌",message:"网络未连接"}),E=b(()=>{const e=parseFloat(y.value);return e>.01?{class:"success",icon:"✅",message:"余额充足"}:e>0?{class:"warning",icon:"⚠️",message:"余额不足"}:{class:"error",icon:"❌",message:"无余额"}}),h=b(()=>m.value&&m.value!=="0x..."&&w.value&&w.value!=="0x..."),C=b(()=>parseFloat(y.value)>.01),L=b(()=>i.value&&h.value&&r.value===o.value.chainId&&g.value>0),M=async()=>{try{await U(),await T()}catch(e){n("连接钱包失败: "+e.message)}},T=async()=>{try{i.value&&B.value&&(y.value=(Number(B.value)/1e18).toFixed(4)),await V(),I()}catch(e){n("刷新钱包状态失败: "+e.message)}},W=()=>{window.open("/test/config","_blank")},K=async()=>{try{await A.initialize(),n("合约连接测试: 成功")}catch(e){n("合约连接测试失败: "+e.message)}},Y=async()=>{await T()},z=()=>{const t={11155111:"https://sepoliafaucet.com/",5:"https://goerlifaucet.com/",80001:"https://faucet.polygon.technology/"}[o.value.chainId];t?(window.open(t,"_blank"),n(`已打开测试网水龙头: ${t}`)):n("当前网络不支持测试网水龙头")},G=async()=>{try{n(`开始测试买入 ${g.value} 个代币...`);const e=await A.buyTokens(g.value);e.success?n(`测试买入成功: ${e.transactionHash}`):n(`测试买入失败: ${e.error}`)}catch(e){n("测试买入异常: "+e.message)}},q=async()=>{try{n(`开始测试卖出 ${g.value} 个代币...`);const e=await A.sellTokens(g.value);e.success?n(`测试卖出成功: ${e.transactionHash}`):n(`测试卖出失败: ${e.error}`)}catch(e){n("测试卖出异常: "+e.message)}},J=async()=>{n("开始运行完整诊断..."),i.value||n("问题: 钱包未连接"),h.value||n("问题: 合约地址未配置"),r.value!==o.value.chainId&&n(`问题: 网络不匹配 (当前: ${r.value}, 目标: ${o.value.chainId})`),C.value||n("问题: ETH余额不足"),n("完整诊断完成"),I()},I=()=>{l.value=[],i.value||l.value.push("请先连接MetaMask钱包"),h.value||l.value.push("请配置智能合约地址 (/test/config)"),r.value!==o.value.chainId&&l.value.push(`请切换到 ${o.value.name} 网络`),C.value||l.value.push("请确保账户有足够的ETH余额"),l.value.length===0&&l.value.push("所有检查都通过，交易功能应该正常工作")},n=e=>{d.value.unshift({timestamp:Date.now(),message:e}),d.value.length>20&&(d.value=d.value.slice(0,20))},P=()=>{d.value=[]},Q=()=>{const e={timestamp:new Date().toISOString(),wallet:{connected:i.value,address:N.value,chainId:r.value,network:$.value,balance:y.value},contract:{tradeAddress:m.value,kycAddress:w.value,targetNetwork:o.value,configValid:h.value},errors:d.value,suggestions:l.value},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),c=URL.createObjectURL(t),f=document.createElement("a");f.href=c,f.download=`trade-diagnostic-${Date.now()}.json`,f.click(),URL.revokeObjectURL(c)},X=()=>{confirm("确定要重置所有设置吗？这将清除所有配置和日志。")&&(localStorage.clear(),location.reload())},Z=e=>new Date(e).toLocaleTimeString();return es(()=>{T(),I()}),(e,t)=>(_(),p("div",ls,[t[27]||(t[27]=s("h1",null,"🔍 交易功能诊断",-1)),s("div",os,[t[5]||(t[5]=s("h2",null,"📊 诊断概览",-1)),s("div",is,[s("div",{class:u(["status-item",S.value.class])},[s("div",cs,a(S.value.icon),1),s("div",us,[t[1]||(t[1]=s("h3",null,"钱包连接",-1)),s("p",null,a(S.value.message),1)])],2),s("div",{class:u(["status-item",x.value.class])},[s("div",rs,a(x.value.icon),1),s("div",ds,[t[2]||(t[2]=s("h3",null,"合约配置",-1)),s("p",null,a(x.value.message),1)])],2),s("div",{class:u(["status-item",D.value.class])},[s("div",vs,a(D.value.icon),1),s("div",gs,[t[3]||(t[3]=s("h3",null,"网络连接",-1)),s("p",null,a(D.value.message),1)])],2),s("div",{class:u(["status-item",E.value.class])},[s("div",ms,a(E.value.icon),1),s("div",fs,[t[4]||(t[4]=s("h3",null,"账户余额",-1)),s("p",null,a(E.value.message),1)])],2)])]),s("div",bs,[t[25]||(t[25]=s("h2",null,"🔧 详细诊断",-1)),s("div",ps,[t[10]||(t[10]=s("h3",null,"💰 钱包状态",-1)),s("div",_s,[s("div",hs,[t[6]||(t[6]=s("label",null,"连接状态:",-1)),s("span",{class:u(k(i)?"success":"error")},a(k(i)?"已连接":"未连接"),3)]),s("div",ks,[t[7]||(t[7]=s("label",null,"钱包地址:",-1)),s("span",null,a(k(N)||"未连接"),1)]),s("div",ws,[t[8]||(t[8]=s("label",null,"网络ID:",-1)),s("span",null,a(k(r)||"未知"),1)]),s("div",ys,[t[9]||(t[9]=s("label",null,"网络名称:",-1)),s("span",null,a(k($)||"未知"),1)])]),s("div",Cs,[s("button",{onClick:M,disabled:k(i),class:"btn primary"}," 连接钱包 ",8,Ts),s("button",{onClick:T,class:"btn secondary"}," 刷新状态 ")])]),s("div",Ss,[t[15]||(t[15]=s("h3",null,"📋 合约配置",-1)),s("div",xs,[s("div",Ds,[t[11]||(t[11]=s("label",null,"交易合约地址:",-1)),s("span",{class:u(m.value?"success":"error")},a(m.value||"未配置"),3)]),s("div",Es,[t[12]||(t[12]=s("label",null,"KYC合约地址:",-1)),s("span",{class:u(w.value?"success":"error")},a(w.value||"未配置"),3)]),s("div",Is,[t[13]||(t[13]=s("label",null,"目标网络:",-1)),s("span",null,a(o.value.name)+" ("+a(o.value.chainId)+")",1)]),s("div",Rs,[t[14]||(t[14]=s("label",null,"配置状态:",-1)),s("span",{class:u(h.value?"success":"error")},a(h.value?"配置完整":"配置不完整"),3)])]),s("div",{class:"action-buttons"},[s("button",{onClick:W,class:"btn primary"}," 配置合约地址 "),s("button",{onClick:K,class:"btn secondary"}," 测试合约连接 ")])]),s("div",As,[t[19]||(t[19]=s("h3",null,"💳 账户余额",-1)),s("div",Ns,[s("div",$s,[t[16]||(t[16]=s("label",null,"ETH余额:",-1)),s("span",null,a(y.value||"0")+" ETH",1)]),s("div",Bs,[t[17]||(t[17]=s("label",null,"代币余额:",-1)),s("span",null,a(j.value||"0")+" 代币",1)]),s("div",Ls,[t[18]||(t[18]=s("label",null,"余额状态:",-1)),s("span",{class:u(C.value?"success":"warning")},a(C.value?"余额充足":"余额不足"),3)])]),s("div",{class:"action-buttons"},[s("button",{onClick:Y,class:"btn secondary"}," 刷新余额 "),s("button",{onClick:z,class:"btn warning"}," 获取测试ETH ")])]),s("div",Fs,[t[21]||(t[21]=s("h3",null,"🧪 交易测试",-1)),s("div",Hs,[s("div",Os,[t[20]||(t[20]=s("label",null,"测试交易数量:",-1)),as(s("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>g.value=c),type:"number",placeholder:"输入测试数量"},null,512),[[ns,g.value]])]),s("div",Us,[s("button",{onClick:G,disabled:!L.value,class:"btn primary"}," 测试买入 ",8,Vs),s("button",{onClick:q,disabled:!L.value,class:"btn secondary"}," 测试卖出 ",8,js)])])]),d.value.length>0?(_(),p("div",Ms,[t[22]||(t[22]=s("h3",null,"❌ 错误日志",-1)),s("div",Ws,[(_(!0),p(H,null,O(d.value,(c,f)=>(_(),p("div",{key:f,class:"error-log"},[s("div",Ks,a(Z(c.timestamp)),1),s("div",Ys,a(c.message),1)]))),128))]),s("button",{onClick:P,class:"btn secondary"}," 清除日志 ")])):F("",!0),l.value.length>0?(_(),p("div",zs,[t[24]||(t[24]=s("h3",null,"💡 修复建议",-1)),s("div",Gs,[(_(!0),p(H,null,O(l.value,(c,f)=>(_(),p("div",{key:f,class:"suggestion"},[t[23]||(t[23]=s("div",{class:"suggestion-icon"},"💡",-1)),s("div",qs,a(c),1)]))),128))])])):F("",!0)]),s("div",{class:"quick-actions"},[t[26]||(t[26]=s("h2",null,"⚡ 快速操作",-1)),s("div",{class:"action-buttons"},[s("button",{onClick:J,class:"btn primary"}," 运行完整诊断 "),s("button",{onClick:Q,class:"btn secondary"}," 导出诊断报告 "),s("button",{onClick:X,class:"btn warning"}," 重置所有设置 ")])])]))}},Xs=ss(Js,[["__scopeId","data-v-5789df3c"]]);export{Xs as default};
